import StyleDictionary from 'style-dictionary';
import { initializeCustomTransforms } from './transforms.js';

// REGISTRUJ custom transfome i grupe na GLOBALNOM StyleDictionary objektu
i nitializeCustomTransforms(StyleDictionary);

// Custom format for CSS variables with theming support
StyleDictionary.registerFormat({
  name: 'css/variables-themed',
  format: ({dictionary, options}) => {
    const theme = options.theme || 'light';
    
    return `/* DynUI Design Tokens - ${theme} theme */
/* Auto-generated by Style Dictionary - DO NOT EDIT */

:root,
[data-theme="${theme}"] {
${dictionary.allTokens.map(token => {
  const name = token.name.startsWith('dyn-') ? token.name : `dyn-${token.name}`;
  return `  --${name}: ${token.value};`;
}).join('\n')}
}

/* CSS Custom Properties Export for JavaScript */
export const ${theme}Tokens = {
${dictionary.allTokens.map(token => {
  const name = token.name.startsWith('dyn-') ? token.name : `dyn-${token.name}`;
  const jsName = name.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  return `  '${jsName}': 'var(--${name})',`;
}).join('\n')}
};
`;
  }
});

// Enhanced configuration with multiple output formats
export default {
  source: ['src/tokens/**/*.json'],
  platforms: {
    css: {
      transformGroup: 'dyn/css',
      buildPath: 'dist/',
      files: [
        {
          destination: 'tokens.css',
          format: 'css/variables-themed',
          options: { theme: 'light' }
        },
        {
          destination: 'tokens-dark.css',
          format: 'css/variables-themed',
          options: { theme: 'dark' }
        },
        {
          destination: 'variables.css',
          format: 'css/variables'
        }
      ]
    },
    js: {
      transformGroup: 'js',
      buildPath: 'dist/',
      files: [
        {
          destination: 'tokens.js',
          format: 'javascript/es6'
        }
      ]
    },
    json: {
      transformGroup: 'js',
      buildPath: 'dist/',
      files: [
        {
          destination: 'tokens.json',
          format: 'json/flat'
        },
        {
          destination: 'tokens-nested.json',
          format: 'json/nested'
        }
      ]
    }
  }
};
